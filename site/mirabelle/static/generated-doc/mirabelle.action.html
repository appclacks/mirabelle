<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>mirabelle.action documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Mirabelle</span> <span class="project-version">0.13.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mirabelle</span></div></div></li><li class="depth-2 current"><a href="mirabelle.action.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>action</span></div></a></li><li class="depth-3"><a href="mirabelle.action.condition.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>condition</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.b64.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>b64</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.event.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>event</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.graphviz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphviz</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.io.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.math.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>math</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>otel</span></div></div></li><li class="depth-3"><a href="mirabelle.otel.traces.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>traces</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>output</span></div></div></li><li class="depth-3 branch"><a href="mirabelle.output.batch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>batch</span></div></a></li><li class="depth-3 branch"><a href="mirabelle.output.elasticsearch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>elasticsearch</span></div></a></li><li class="depth-3 branch"><a href="mirabelle.output.file.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>file</span></div></a></li><li class="depth-3 branch"><a href="mirabelle.output.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-3 branch"><a href="mirabelle.output.pagerduty.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pagerduty</span></div></a></li><li class="depth-3"><a href="mirabelle.output.prometheus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>prometheus</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.path.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>path</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.pool.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pool</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.prometheus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>prometheus</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.pubsub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pubsub</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.stream.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stream</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2 branch"><a href="mirabelle.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="mirabelle.transport.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transport</span></div></a></li><li class="depth-3 branch"><a href="mirabelle.transport.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-3 branch"><a href="mirabelle.transport.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-3"><a href="mirabelle.transport.websocket.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websocket</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="mirabelle.action.html#var-above-dt"><div class="inner"><span>above-dt</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-action-.3Efn"><div class="inner"><span>action-&gt;fn</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-aggregation*"><div class="inner"><span>aggregation*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-async-queue.21"><div class="inner"><span>async-queue!</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-async-queue.21*"><div class="inner"><span>async-queue!*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-below-dt"><div class="inner"><span>below-dt</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-between-dt"><div class="inner"><span>between-dt</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-bottom"><div class="inner"><span>bottom</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-by"><div class="inner"><span>by</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-by-fn"><div class="inner"><span>by-fn</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-by-get-field-fn"><div class="inner"><span>by-get-field-fn</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-call-rescue"><div class="inner"><span>call-rescue</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-changed"><div class="inner"><span>changed</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-changed*"><div class="inner"><span>changed*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-clear-forks"><div class="inner"><span>clear-forks</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coalesce"><div class="inner"><span>coalesce</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coalesce*"><div class="inner"><span>coalesce*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-bottom"><div class="inner"><span>coll-bottom</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-bottom*"><div class="inner"><span>coll-bottom*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-count"><div class="inner"><span>coll-count</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-count*"><div class="inner"><span>coll-count*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-increase"><div class="inner"><span>coll-increase</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-increase*"><div class="inner"><span>coll-increase*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-max"><div class="inner"><span>coll-max</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-max*"><div class="inner"><span>coll-max*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-mean"><div class="inner"><span>coll-mean</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-mean*"><div class="inner"><span>coll-mean*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-min"><div class="inner"><span>coll-min</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-min*"><div class="inner"><span>coll-min*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-percentiles"><div class="inner"><span>coll-percentiles</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-percentiles*"><div class="inner"><span>coll-percentiles*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-quotient"><div class="inner"><span>coll-quotient</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-quotient*"><div class="inner"><span>coll-quotient*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-rate"><div class="inner"><span>coll-rate</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-rate*"><div class="inner"><span>coll-rate*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-sort"><div class="inner"><span>coll-sort</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-sort*"><div class="inner"><span>coll-sort*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-sum"><div class="inner"><span>coll-sum</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-sum*"><div class="inner"><span>coll-sum*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-top"><div class="inner"><span>coll-top</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-top*"><div class="inner"><span>coll-top*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-where"><div class="inner"><span>coll-where</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-coll-where*"><div class="inner"><span>coll-where*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-cond-dt"><div class="inner"><span>cond-dt</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-cond-dt*"><div class="inner"><span>cond-dt*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-custom"><div class="inner"><span>custom</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ddt"><div class="inner"><span>ddt</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ddt*"><div class="inner"><span>ddt*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ddt-pos"><div class="inner"><span>ddt-pos</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-debug"><div class="inner"><span>debug</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-debug*"><div class="inner"><span>debug*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-decrement"><div class="inner"><span>decrement</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-decrement*"><div class="inner"><span>decrement*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-default"><div class="inner"><span>default</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-default*"><div class="inner"><span>default*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-default-aggr-finalizer"><div class="inner"><span>default-aggr-finalizer</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-dissoc-in"><div class="inner"><span>dissoc-in</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-duration-.3Ens"><div class="inner"><span>duration-&gt;ns</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-error"><div class="inner"><span>error</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-error*"><div class="inner"><span>error*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ewma-timeless"><div class="inner"><span>ewma-timeless</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ewma-timeless*"><div class="inner"><span>ewma-timeless*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-exception-.3Eevent"><div class="inner"><span>exception-&gt;event</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-exception-stream"><div class="inner"><span>exception-stream</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-exception-stream*"><div class="inner"><span>exception-stream*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-expired"><div class="inner"><span>expired</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-expired*"><div class="inner"><span>expired*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-extract"><div class="inner"><span>extract</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-extract*"><div class="inner"><span>extract*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-fixed-event-window"><div class="inner"><span>fixed-event-window</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-fixed-event-window*"><div class="inner"><span>fixed-event-window*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-fixed-time-window"><div class="inner"><span>fixed-time-window</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-from-base64"><div class="inner"><span>from-base64</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-from-base64*"><div class="inner"><span>from-base64*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-from-json"><div class="inner"><span>from-json</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-from-json*"><div class="inner"><span>from-json*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-gen-doc"><div class="inner"><span>gen-doc</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-get-env-profile"><div class="inner"><span>get-env-profile</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-get-fork-and-gc"><div class="inner"><span>get-fork-and-gc</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-get-window"><div class="inner"><span>get-window</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-include"><div class="inner"><span>include</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-increment"><div class="inner"><span>increment</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-increment*"><div class="inner"><span>increment*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-info"><div class="inner"><span>info</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-info*"><div class="inner"><span>info*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-io"><div class="inner"><span>io</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-io*"><div class="inner"><span>io*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-keep-keys"><div class="inner"><span>keep-keys</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-keep-keys*"><div class="inner"><span>keep-keys*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-keyword-.3Eaggr-finalizer-fn"><div class="inner"><span>keyword-&gt;aggr-finalizer-fn</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-keyword-.3Eaggr-fn"><div class="inner"><span>keyword-&gt;aggr-fn</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-log-action"><div class="inner"><span>log-action</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-mean"><div class="inner"><span>mean</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-moving-event-window"><div class="inner"><span>moving-event-window</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-moving-event-window*"><div class="inner"><span>moving-event-window*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-moving-time-window"><div class="inner"><span>moving-time-window</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-moving-time-window*"><div class="inner"><span>moving-time-window*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-not-expired"><div class="inner"><span>not-expired</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-not-expired*"><div class="inner"><span>not-expired*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-output.21"><div class="inner"><span>output!</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-output.21*"><div class="inner"><span>output!*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-outside-dt"><div class="inner"><span>outside-dt</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-over"><div class="inner"><span>over</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-over*"><div class="inner"><span>over*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-percentiles"><div class="inner"><span>percentiles</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-percentiles*"><div class="inner"><span>percentiles*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-project"><div class="inner"><span>project</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-project*"><div class="inner"><span>project*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-publish.21"><div class="inner"><span>publish!</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-publish.21*"><div class="inner"><span>publish!*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-rate"><div class="inner"><span>rate</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ratio"><div class="inner"><span>ratio</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ratio-state-update"><div class="inner"><span>ratio-state-update</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-reinject.21"><div class="inner"><span>reinject!</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-reinject.21*"><div class="inner"><span>reinject!*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-rename-keys"><div class="inner"><span>rename-keys</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-rename-keys*"><div class="inner"><span>rename-keys*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-scale"><div class="inner"><span>scale</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-scale*"><div class="inner"><span>scale*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-scondition*"><div class="inner"><span>scondition*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sdissoc"><div class="inner"><span>sdissoc</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sdissoc*"><div class="inner"><span>sdissoc*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sdo"><div class="inner"><span>sdo</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sdo*"><div class="inner"><span>sdo*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-select-keys-nested"><div class="inner"><span>select-keys-nested</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sflatten"><div class="inner"><span>sflatten</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sflatten*"><div class="inner"><span>sflatten*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sformat"><div class="inner"><span>sformat</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sformat*"><div class="inner"><span>sformat*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-smax"><div class="inner"><span>smax</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-smin"><div class="inner"><span>smin</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-split"><div class="inner"><span>split</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-split*"><div class="inner"><span>split*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-ssort"><div class="inner"><span>ssort</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-stable"><div class="inner"><span>stable</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-stable*"><div class="inner"><span>stable*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-stream"><div class="inner"><span>stream</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-streams"><div class="inner"><span>streams</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-sum"><div class="inner"><span>sum</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-tag"><div class="inner"><span>tag</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-tag*"><div class="inner"><span>tag*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-tagged-all"><div class="inner"><span>tagged-all</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-tagged-all*"><div class="inner"><span>tagged-all*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-tap"><div class="inner"><span>tap</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-tap*"><div class="inner"><span>tap*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-test-action"><div class="inner"><span>test-action</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-test-action*"><div class="inner"><span>test-action*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-throttle"><div class="inner"><span>throttle</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-throttle*"><div class="inner"><span>throttle*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-to-base64"><div class="inner"><span>to-base64</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-to-base64*"><div class="inner"><span>to-base64*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-to-string"><div class="inner"><span>to-string</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-to-string*"><div class="inner"><span>to-string*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-top"><div class="inner"><span>top</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-under"><div class="inner"><span>under</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-under*"><div class="inner"><span>under*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-untag"><div class="inner"><span>untag</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-untag*"><div class="inner"><span>untag*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-where"><div class="inner"><span>where</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-where*"><div class="inner"><span>where*</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-with"><div class="inner"><span>with</span></div></a></li><li class="depth-1"><a href="mirabelle.action.html#var-with*"><div class="inner"><span>with*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">mirabelle.action</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-above-dt"><h3>above-dt</h3><div class="usage"><code>(above-dt config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a number <code>threshold</code> and a time period in seconds <code>duration</code>. If the condition “the event metric is &gt; to the threshold” is valid for all events received during at least the period <code>duration</code>, valid events received after the <code>duration</code> period will be passed on until an invalid event arrives. <code>:metric</code> should not be nil (it will produce exceptions).</p>
<pre><code class="language-clojure">(above-dt {:threshold 100 :duration 10}
  (debug))
</code></pre>
<p>In this example, if the events <code>:metric</code> field are greater than 100 for more than 10 seconds, events are passed downstream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L512">view source</a></div></div><div class="public anchor" id="var-action-.3Efn"><h3>action-&gt;fn</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L3012">view source</a></div></div><div class="public anchor" id="var-aggregation*"><h3>aggregation*</h3><div class="usage"><code>(aggregation* _ {:keys [duration], :as config} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2387">view source</a></div></div><div class="public anchor" id="var-async-queue.21"><h3>async-queue!</h3><div class="usage"><code>(async-queue! queue-name &amp; children)</code></div><div class="doc"><div class="markdown"><p>Execute children into the specific async queue. The async queue should be defined in the I/O configuration file.</p>
<pre><code class="language-clojure">(async-queue! :my-queue
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1694">view source</a></div></div><div class="public anchor" id="var-async-queue.21*"><h3>async-queue!*</h3><div class="usage"><code>(async-queue!* context queue-name &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1682">view source</a></div></div><div class="public anchor" id="var-below-dt"><h3>below-dt</h3><div class="usage"><code>(below-dt config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a number <code>threshold</code> and a time period in seconds <code>duration</code>. If the condition <code>the event metric is &lt; to the threshold</code> is valid for all events received during at least the period <code>duration</code>, valid events received after the <code>duration</code> period will be passed on until an invalid event arrives. <code>:metric</code> should not be nil (it will produce exceptions).</p>
<pre><code class="language-clojure">(below-dt {:threshold 100 :duration 10}
(debug))
</code></pre>
<p>In this example, if the events <code>:metric</code> field are lower than 100 for more than 10 seconds, events are passed downstream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L538">view source</a></div></div><div class="public anchor" id="var-between-dt"><h3>between-dt</h3><div class="usage"><code>(between-dt config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes two numbers, <code>low</code> and <code>high</code>, and a time period in seconds, <code>duration</code>. If the condition <code>the event metric is &gt; low and &lt; high</code> is valid for all events received during at least the period <code>duration</code>, valid events received after the <code>duration</code> period will be passed on until an invalid event arrives. <code>:metric</code> should not be nil (it will produce exceptions).</p>
<pre><code class="language-clojure">(between-dt {:low 50 :high 100 :duration 10}
  (debug))
</code></pre>
<p>In this example, if the events <code>:metric</code> field are between 50 ans 100 for more than 10 seconds, events are passed downstream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L564">view source</a></div></div><div class="public anchor" id="var-bottom"><h3>bottom</h3><div class="usage"><code>(bottom config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Get the min event from the last dt seconds.</p>
<pre><code class="language-clojure">(bottom {:duration 10}
  (info))
</code></pre>
<p>You can pass a <code>:delay</code> key to the configuration in order to tolerate late events. In that case, events from previous windows will be flushed after this delay:</p>
<pre><code class="language-clojure">(bottom {:duration 10 :delay 5}
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2516">view source</a></div></div><div class="public anchor" id="var-by"><h3>by</h3><div class="usage"><code>(by config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Split stream by field Every time an event arrives with a new value of field, this action invokes its child forms to return a <em>new</em>, distinct set of streams for that particular value.</p>
<pre><code class="language-clojure">(by {:fields [:host :service]}
  (fixed-time-window {:duration 60}))
</code></pre>
<p>This example generates a moving window for each host/service combination.</p>
<p>You can also pass the <code>:gc-interval</code> and <code>:fork-ttl</code> keys to the action. This will enable garbage collections of children actions, executed every <code>:gc-interval</code> (in seconds) and which will remove actions which didn’t receive events since <code>:fork-ttl</code> seconds</p>
<pre><code class="language-clojure">(by {:fields [:host :service [:a :nested-key]
     :gc-interval 3600
     :fork-ttl 1800}
  (fixed-time-window {:duration 60}))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1611">view source</a></div></div><div class="public anchor" id="var-by-fn"><h3>by-fn</h3><div class="usage"><code>(by-fn {:keys [fields gc-interval fork-ttl]} new-fork)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1591">view source</a></div></div><div class="public anchor" id="var-by-get-field-fn"><h3>by-get-field-fn</h3><div class="usage"><code>(by-get-field-fn field)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1584">view source</a></div></div><div class="public anchor" id="var-call-rescue"><h3>call-rescue</h3><div class="usage"><code>(call-rescue event children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L74">view source</a></div></div><div class="public anchor" id="var-changed"><h3>changed</h3><div class="usage"><code>(changed config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Passes on events only if the <code>field</code> passed as parameter differs from the previous one. The <code>init</code> parameter is the default value for the stream.</p>
<pre><code class="language-clojure">(changed {:field :state :init "ok"})
</code></pre>
<p>For example, this action will let event pass if the :state field vary, the initial value being <code>ok</code>.</p>
<p>This stream is useful to get only events making a transition.</p>
<p>It also supported nested fields:</p>
<pre><code class="language-clojure">(changed {:field [:nested :field] :init "ok"})
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1349">view source</a></div></div><div class="public anchor" id="var-changed*"><h3>changed*</h3><div class="usage"><code>(changed* _ {:keys [field init]} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1329">view source</a></div></div><div class="public anchor" id="var-clear-forks"><h3>clear-forks</h3><div class="usage"><code>(clear-forks state current-time fork-ttl)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1559">view source</a></div></div><div class="public anchor" id="var-coalesce"><h3>coalesce</h3><div class="usage"><code>(coalesce config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Returns a list of the latest non-expired events (by <code>fields</code>) every dt seconds (at best).</p>
<pre><code class="language-clojure">(coalesce {:duration 10 :fields [:host :service]}
  (debug)
</code></pre>
<p>In this example, the latest event for each host/service combination will be kept and forwarded downstream. The <code>debug</code> action will then receive this list of events. Expired events will be removed from the list.</p>
<p>coalesce supports nested fields:</p>
<pre><code class="language-clojure">(coalesce {:duration 10 :fields [:host [:nested :field]]}
  (debug)
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L792">view source</a></div></div><div class="public anchor" id="var-coalesce*"><h3>coalesce*</h3><div class="usage"><code>(coalesce* _ {:keys [duration fields]} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L721">view source</a></div></div><div class="public anchor" id="var-coll-bottom"><h3>coll-bottom</h3><div class="usage"><code>(coll-bottom nb-events &amp; children)</code></div><div class="doc"><div class="markdown"><p>Receives a list of events, returns the bottom N events with the lowest metrics.</p>
<pre><code class="language-clojure">(fixed-time-window {:duration 60}
  (coll-bottom 5
    (info)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2037">view source</a></div></div><div class="public anchor" id="var-coll-bottom*"><h3>coll-bottom*</h3><div class="usage"><code>(coll-bottom* _ nb-events &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2030">view source</a></div></div><div class="public anchor" id="var-coll-count"><h3>coll-count</h3><div class="usage"><code>(coll-count &amp; children)</code></div><div class="doc"><div class="markdown"><p>Count the number of events. Should receive a list of events from the previous stream. The most recent event is used as a base to create the new event, and its :metric field is set to the number of events received as input.</p>
<pre><code class="language-clojure">(fixed-time-window {:duration 60}
  (coll-count
    (debug)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1473">view source</a></div></div><div class="public anchor" id="var-coll-count*"><h3>coll-count*</h3><div class="usage"><code>(coll-count* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1465">view source</a></div></div><div class="public anchor" id="var-coll-increase"><h3>coll-increase</h3><div class="usage"><code>(coll-increase &amp; children)</code></div><div class="doc"><div class="markdown"><p>Receives a list of events which should represent an always-increasing counter and returns the latest event with its :metric field set to the value of the increase between the oldest and the latest event.</p>
<p>If it receives for example:</p>
<pre><code class="language-clojure">[{:time 1 :metric 10} {:time 9 :metric 20} {:time 20 :metric 30}}
</code></pre>
<p>It will produces (30-10 = 20):</p>
<pre><code class="language-clojure">{:time 20 :metric 20}
</code></pre>
<p>Events produced with a negative metric (which can happen if the counter is resetted) are not send downstream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2719">view source</a></div></div><div class="public anchor" id="var-coll-increase*"><h3>coll-increase*</h3><div class="usage"><code>(coll-increase* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2693">view source</a></div></div><div class="public anchor" id="var-coll-max"><h3>coll-max</h3><div class="usage"><code>(coll-max &amp; children)</code></div><div class="doc"><div class="markdown"><p>Returns the event with the biggest metric. Should receive a list of events from the previous stream.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 10}
  (coll-max
    (debug)))
</code></pre>
<p>Get the event the biggest metric on windows of 10 events.</p>
<p>Check <code>top</code> and <code>smax</code> as well.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L291">view source</a></div></div><div class="public anchor" id="var-coll-max*"><h3>coll-max*</h3><div class="usage"><code>(coll-max* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L286">view source</a></div></div><div class="public anchor" id="var-coll-mean"><h3>coll-mean</h3><div class="usage"><code>(coll-mean &amp; children)</code></div><div class="doc"><div class="markdown"><p>Computes the events mean (on metric). Should receive a list of events from the previous stream. The most recent event is used as a base to create the new event</p>
<pre><code class="language-clojure">(fixed-event-window {:size 10}
  (coll-mean
    (debug)))
</code></pre>
<p>Computes the mean on windows of 10 events</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L269">view source</a></div></div><div class="public anchor" id="var-coll-mean*"><h3>coll-mean*</h3><div class="usage"><code>(coll-mean* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L264">view source</a></div></div><div class="public anchor" id="var-coll-min"><h3>coll-min</h3><div class="usage"><code>(coll-min &amp; children)</code></div><div class="doc"><div class="markdown"><p>Returns the event with the smallest metric. Should receive a list of events from the previous stream.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 10}
  (coll-min
    (debug)))
</code></pre>
<p>Get the event the smallest metric on windows of 10 events.</p>
<p>Check <code>bottom</code> and <code>smin</code> as well.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L350">view source</a></div></div><div class="public anchor" id="var-coll-min*"><h3>coll-min*</h3><div class="usage"><code>(coll-min* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L345">view source</a></div></div><div class="public anchor" id="var-coll-percentiles"><h3>coll-percentiles</h3><div class="usage"><code>(coll-percentiles points &amp; children)</code></div><div class="doc"><div class="markdown"><p>Receives a list of events and selects one event from that period for each point. If point is 0, takes the lowest metric event.  If point is 1, takes the highest metric event. 0.5 is the median event, and so forth. Forwards each of these events to children. The event has the point appended the <code>:quantile</code> key. Useful for extracting histograms and percentiles.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 10}
  (coll-percentiles [0.5 0.75 0.98 0.99]))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1538">view source</a></div></div><div class="public anchor" id="var-coll-percentiles*"><h3>coll-percentiles*</h3><div class="usage"><code>(coll-percentiles* _ points &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1528">view source</a></div></div><div class="public anchor" id="var-coll-quotient"><h3>coll-quotient</h3><div class="usage"><code>(coll-quotient &amp; children)</code></div><div class="doc"><div class="markdown"><p>Divide the first event <code>:metrìc</code> field by all subsequent events <code>:metric</code>. Return a new event containing the new <code>:metric</code>.</p>
<p>Should receive a list of events from the previous stream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L314">view source</a></div></div><div class="public anchor" id="var-coll-quotient*"><h3>coll-quotient*</h3><div class="usage"><code>(coll-quotient* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L309">view source</a></div></div><div class="public anchor" id="var-coll-rate"><h3>coll-rate</h3><div class="usage"><code>(coll-rate &amp; children)</code></div><div class="doc"><div class="markdown"><p>Computes the rate on a list of events. Should receive a list of events from the previous stream. The latest event is used as a base to build the new event.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 3}
  (coll-rate
    (debug)))
</code></pre>
<p>If this example receives the events:</p>
<p>{:metric 1 :time 1} {:metric 2 :time 2} {:metric 1 :time 3}</p>
<p>The stream will return {:metric 2 :time 3}</p>
<p>Indeed, (1+2+1)/2 = 3 (we divide by 2 because we have 2 seconds between the min and max events time).</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L890">view source</a></div></div><div class="public anchor" id="var-coll-rate*"><h3>coll-rate*</h3><div class="usage"><code>(coll-rate* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L885">view source</a></div></div><div class="public anchor" id="var-coll-sort"><h3>coll-sort</h3><div class="usage"><code>(coll-sort field &amp; children)</code></div><div class="doc"><div class="markdown"><p>Sort events based on the field passed as parameter Should receive a list of events from the previous stream.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 10}
  (coll-sort :time
    (debug)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L375">view source</a></div></div><div class="public anchor" id="var-coll-sort*"><h3>coll-sort*</h3><div class="usage"><code>(coll-sort* _ field &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L370">view source</a></div></div><div class="public anchor" id="var-coll-sum"><h3>coll-sum</h3><div class="usage"><code>(coll-sum &amp; children)</code></div><div class="doc"><div class="markdown"><p>Sum all the events :metric fields Should receive a list of events from the previous stream.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 10}
  (coll-sum
    (debug)))
</code></pre>
<p>Sum all :metric fields for windows of 10 events</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L329">view source</a></div></div><div class="public anchor" id="var-coll-sum*"><h3>coll-sum*</h3><div class="usage"><code>(coll-sum* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L324">view source</a></div></div><div class="public anchor" id="var-coll-top"><h3>coll-top</h3><div class="usage"><code>(coll-top nb-events &amp; children)</code></div><div class="doc"><div class="markdown"><p>Receives a list of events, returns the top N events with the highest metrics.</p>
<pre><code class="language-clojure">(fixed-time-window {:duration 60}
  (coll-top 5
    (info)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2014">view source</a></div></div><div class="public anchor" id="var-coll-top*"><h3>coll-top*</h3><div class="usage"><code>(coll-top* _ nb-events &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2007">view source</a></div></div><div class="public anchor" id="var-coll-where"><h3>coll-where</h3><div class="usage"><code>(coll-where conditions &amp; children)</code></div><div class="doc"><div class="markdown"><p>Like <code>where</code> but should receive a list of events.</p>
<pre><code class="language-clojure">(fixed-time-window {:duration 60}
  (coll-where [:and [:= :host "foo"]
                    [:&gt; :metric 10]))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L123">view source</a></div></div><div class="public anchor" id="var-coll-where*"><h3>coll-where*</h3><div class="usage"><code>(coll-where* _ conditions &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L115">view source</a></div></div><div class="public anchor" id="var-cond-dt"><h3>cond-dt</h3><div class="usage"><code>(cond-dt config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a time period in seconds <code>duration</code>. If all events received during at least the period <code>duration</code> matches the condition, events will be passed on until</p>
<pre><code class="language-clojure">(cond-dt {:duration 10 :condition [:= :state "error"]}
  (debug))
</code></pre>
<p>In this example, if the events <code>:state</code> are “error” for more than 10 seconds, events are passed downstream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L627">view source</a></div></div><div class="public anchor" id="var-cond-dt*"><h3>cond-dt*</h3><div class="usage"><code>(cond-dt* _ conditions dt &amp; children)</code></div><div class="doc"><div class="markdown"><p>A stream which detects if a condition <code>(f event)</code> is true during <code>dt</code> seconds. Takes <code>conditions</code> (like in the where action) and a time period <code>dt</code> in seconds. If the condition is valid for all events received during at least the period <code>dt</code>, valid events received after the <code>dt</code> period will be passed on until an invalid event arrives. Skips events that are too old or that do not have a timestamp.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L476">view source</a></div></div><div class="public anchor" id="var-custom"><h3>custom</h3><div class="usage"><code>(custom action-name params &amp; children)</code></div><div class="doc"><div class="markdown"><p>Executes a custom action. Custom actions are defined in the Mirabelle configuration file. The actomn can then be called (by name) using this <code>custom</code> action.</p>
<pre><code class="language-clojure">(custom :my-custom-action ["parameters"]
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1852">view source</a></div></div><div class="public anchor" id="var-ddt"><h3>ddt</h3><div class="usage"><code>(ddt &amp; children)</code></div><div class="doc"><div class="markdown"><p>Differentiate metrics with respect to time. Emits an event for each event received, but with metric equal to the difference between the current event and the previous one, divided by the difference in their times. Skips events without metrics.</p>
<pre><code class="language-clojure">(ddt
  (info))
</code></pre>
<p>If ddt receives {:metric 1 :time 1} and {:metric 10 :time 4}, it will produce {:metric (/ 9 3) :time 4}.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1057">view source</a></div></div><div class="public anchor" id="var-ddt*"><h3>ddt*</h3><div class="usage"><code>(ddt* _ remove-neg? &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1042">view source</a></div></div><div class="public anchor" id="var-ddt-pos"><h3>ddt-pos</h3><div class="usage"><code>(ddt-pos &amp; children)</code></div><div class="doc"><div class="markdown"><p>Like ddt but do not forward events with negative metrics. This can be used for counters which may be reseted to zero for example.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1076">view source</a></div></div><div class="public anchor" id="var-debug"><h3>debug</h3><div class="usage"><code>(debug)</code></div><div class="doc"><div class="markdown"><p>Print the event in the logs using the debug level</p>
<pre><code class="language-clojure">(increment
  (debug))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L191">view source</a></div></div><div class="public anchor" id="var-debug*"><h3>debug*</h3><div class="usage"><code>(debug* ctx)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L187">view source</a></div></div><div class="public anchor" id="var-decrement"><h3>decrement</h3><div class="usage"><code>(decrement &amp; children)</code></div><div class="doc"><div class="markdown"><p>Decrement the event :metric field.</p>
<pre><code class="language-clojure">(decrement
  (debug))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L164">view source</a></div></div><div class="public anchor" id="var-decrement*"><h3>decrement*</h3><div class="usage"><code>(decrement* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L158">view source</a></div></div><div class="public anchor" id="var-default"><h3>default</h3><div class="usage"><code>(default field value &amp; children)</code></div><div class="doc"><div class="markdown"><p>Set a default value for an event</p>
<pre><code class="language-clojure">(default :state "ok"
  (info))
</code></pre>
<p>In this example, all events where <code>:state</code> is not set will be updated with <code>:state</code> to “ok”.</p>
<p>It also supports nested keys:</p>
<pre><code class="language-clojure">(default [:nested :key] "ok"
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L666">view source</a></div></div><div class="public anchor" id="var-default*"><h3>default*</h3><div class="usage"><code>(default* _ field value &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L649">view source</a></div></div><div class="public anchor" id="var-default-aggr-finalizer"><h3>default-aggr-finalizer</h3><div class="usage"><code>(default-aggr-finalizer _ event)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2376">view source</a></div></div><div class="public anchor" id="var-dissoc-in"><h3>dissoc-in</h3><div class="usage"><code>(dissoc-in m [k &amp; ks :as keys])</code></div><div class="doc"><div class="markdown"><p>Dissociates an entry from a nested associative structure returning a new nested structure. keys is a sequence of keys. Any empty maps that result will not be present in the new structure.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L60">view source</a></div></div><div class="public anchor" id="var-duration-.3Ens"><h3>duration-&gt;ns</h3><div class="usage"><code>(duration-&gt;ns config)</code></div><div class="doc"><div class="markdown"><p>converts the :duration key to nanoseconds if it exists</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L35">view source</a></div></div><div class="public anchor" id="var-error"><h3>error</h3><div class="usage"><code>(error)</code></div><div class="doc"><div class="markdown"><p>Print the event in the logs using the error level</p>
<pre><code class="language-clojure">(increment
  (debug))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L221">view source</a></div></div><div class="public anchor" id="var-error*"><h3>error*</h3><div class="usage"><code>(error* ctx)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L217">view source</a></div></div><div class="public anchor" id="var-ewma-timeless"><h3>ewma-timeless</h3><div class="usage"><code>(ewma-timeless r &amp; children)</code></div><div class="doc"><div class="markdown"><p>Exponential weighted moving average. Constant space and time overhead. Passes on each event received, but with metric adjusted to the moving average. Does not take the time between events into account. R is the ratio between successive events: r=1 means always return the most recent metric; r=1/2 means the current event counts for half, the previous event for 1/4, the previous event for 1/8, and so on.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1264">view source</a></div></div><div class="public anchor" id="var-ewma-timeless*"><h3>ewma-timeless*</h3><div class="usage"><code>(ewma-timeless* _ r &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1249">view source</a></div></div><div class="public anchor" id="var-exception-.3Eevent"><h3>exception-&gt;event</h3><div class="usage"><code>(exception-&gt;event e base-event)</code></div><div class="doc"><div class="markdown"><p>Build a new event from an Exception and from the event which caused it.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1789">view source</a></div></div><div class="public anchor" id="var-exception-stream"><h3>exception-stream</h3><div class="usage"><code>(exception-stream &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes two actions. If an exception is thrown in the first action, an event representing this exception is emitted in in the second action.</p>
<pre><code>(exception-stream
  (bad-action)
  (error))
</code></pre>
<p>Here, if <code>bad-action</code> throws, an event will be built (using the <code>exception-&gt;event</code> function) and sent to the <code>error</code> action (which will log it).</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1809">view source</a></div></div><div class="public anchor" id="var-exception-stream*"><h3>exception-stream*</h3><div class="usage"><code>(exception-stream* _ success-child failure-child)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1801">view source</a></div></div><div class="public anchor" id="var-expired"><h3>expired</h3><div class="usage"><code>(expired &amp; children)</code></div><div class="doc"><div class="markdown"><p>Keep expired events.</p>
<pre><code class="language-clojure">(expired
  (increment))
</code></pre>
<p>In this example, all expired events will be forwarded to the <code>increment</code>stream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L437">view source</a></div></div><div class="public anchor" id="var-expired*"><h3>expired*</h3><div class="usage"><code>(expired* _ &amp; children)</code></div><div class="doc"><div class="markdown"><p>Keep expired events.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L427">view source</a></div></div><div class="public anchor" id="var-extract"><h3>extract</h3><div class="usage"><code>(extract k &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a key as parameter and send downstream the content of this key.</p>
<pre><code class="language-clojure">(extract :base-event
  (info))
</code></pre>
<p>If <code>extract</code> receives in this example <code>{:time 1 :base-event {:time 1 :service "foo" :host "bar"}</code>, <code>info</code> will receive the content of <code>:base-time</code>.</p>
<p>It also supports nested keys:</p>
<pre><code class="language-clojure">(extract [:foo :bar]
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2809">view source</a></div></div><div class="public anchor" id="var-extract*"><h3>extract*</h3><div class="usage"><code>(extract* _ k &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2797">view source</a></div></div><div class="public anchor" id="var-fixed-event-window"><h3>fixed-event-window</h3><div class="usage"><code>(fixed-event-window config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Returns a fixed-sized window of events.</p>
<pre><code class="language-clojure">(fixed-event-window {:size 5}
  (debug))
</code></pre>
<p>This example will return a vector events partitioned 5 by 5.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L247">view source</a></div></div><div class="public anchor" id="var-fixed-event-window*"><h3>fixed-event-window*</h3><div class="usage"><code>(fixed-event-window* _ {:keys [size]} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L233">view source</a></div></div><div class="public anchor" id="var-fixed-time-window"><h3>fixed-time-window</h3><div class="usage"><code>(fixed-time-window config &amp; children)</code></div><div class="doc"><div class="markdown"><p>A fixed window over the event stream in time. Emits vectors of events, such that each vector has events from a distinct n-second interval. Windows do <em>not</em> overlap; each event appears at most once in the output stream.</p>
<pre><code class="language-clojure">(fixed-time-window {:duration 60}
  (coll-max
    (info)))
</code></pre>
<p>You can pass a <code>:delay</code> key to the configuration in order to tolerate late events. In that case, previous windows will be flushed after this delay:</p>
<pre><code class="language-clojure">(fixed-time-window {:duration 60 :delay 30}
  (coll-max
    (info)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2568">view source</a></div></div><div class="public anchor" id="var-from-base64"><h3>from-base64</h3><div class="usage"><code>(from-base64 field &amp; children)</code></div><div class="doc"><div class="markdown"><p>Decode a base64 field.</p>
<pre><code class="language-clojure">(sdo
  ;; you can pass one field
  (from-base64 :host)
  ;; or a list to update a nested keys
  (from-base64 [:host :service]))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1910">view source</a></div></div><div class="public anchor" id="var-from-base64*"><h3>from-base64*</h3><div class="usage"><code>(from-base64* _ fields &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1899">view source</a></div></div><div class="public anchor" id="var-from-json"><h3>from-json</h3><div class="usage"><code>(from-json k &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a field or a list of fields, and converts the values associated to these fields from a json string to edn.</p>
<pre><code class="language-clojure">(with :my-field "{"foo": "bar"}
  (from-json :my-field))
</code></pre>
<p>In this example, we associate to <code>:my-field</code> a json string and then we call <code>from-json</code> on it. <code>:my-field</code> will now contain an edn map built from the json data, with keywords as keys.</p>
<p>This action also supports nested keys by passing an array of keys (for example <code>(from-json [:nested :key])</code>)</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1767">view source</a></div></div><div class="public anchor" id="var-from-json*"><h3>from-json*</h3><div class="usage"><code>(from-json* _ k &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1753">view source</a></div></div><div class="public anchor" id="var-gen-doc"><h3>gen-doc</h3><div class="usage"><code>(gen-doc)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L3090">view source</a></div></div><div class="public anchor" id="var-get-env-profile"><h3>get-env-profile</h3><div class="usage"><code>(get-env-profile)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2244">view source</a></div></div><div class="public anchor" id="var-get-fork-and-gc"><h3>get-fork-and-gc</h3><div class="usage"><code>(get-fork-and-gc state new-fork fork-name current-time fork-ttl gc-interval)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1567">view source</a></div></div><div class="public anchor" id="var-get-window"><h3>get-window</h3><div class="usage"><code>(get-window event start-time duration)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2380">view source</a></div></div><div class="public anchor" id="var-include"><h3>include</h3><div class="usage"><code>(include path config)</code></div><div class="doc"><div class="markdown"><p>Include an configuration file by path into the configuration. The file will be read using the aero (<a href="https://github.com/juxt/aero/">https://github.com/juxt/aero/</a>) library. The <code>config</code> variable supports these optional options:</p>
<ul>
<li><code>:profile</code>: the aero profile to use. By default, Mirabelle will read (and convert to a Clojure keyword) the PROFILE environment variable during compilation. You can override this value by setting <code>:profile</code>.</li>
<li><code>:variables</code>: variables to pass to the configuration file. You can use the <code>#mirabelle/var</code> reader in order to define variables in your EDN file.</li>
</ul>
<p>This allows you to use the same configuration snippet (eventually templated) from multiple streams (or multiple parts of the same stream)</p>
<pre><code class="language-clojure">(includes"/etc/mirabelle/includes/my-actions.clj {:profile :dev
                                                   :variables {:foo "bar"})
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2249">view source</a></div></div><div class="public anchor" id="var-increment"><h3>increment</h3><div class="usage"><code>(increment &amp; children)</code></div><div class="doc"><div class="markdown"><p>Increment the event :metric field.</p>
<pre><code class="language-clojure">(increment
  (debug))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L145">view source</a></div></div><div class="public anchor" id="var-increment*"><h3>increment*</h3><div class="usage"><code>(increment* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L139">view source</a></div></div><div class="public anchor" id="var-info"><h3>info</h3><div class="usage"><code>(info)</code></div><div class="doc"><div class="markdown"><p>Print the event in the logs using the info level</p>
<pre><code class="language-clojure">(increment
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L206">view source</a></div></div><div class="public anchor" id="var-info*"><h3>info*</h3><div class="usage"><code>(info* ctx)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L202">view source</a></div></div><div class="public anchor" id="var-io"><h3>io</h3><div class="usage"><code>(io &amp; children)</code></div><div class="doc"><div class="markdown"><p>Discard all events in test mode. Else, forward to children. You can use this stream to avoid side effects in test mode.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1716">view source</a></div></div><div class="public anchor" id="var-io*"><h3>io*</h3><div class="usage"><code>(io* context &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1710">view source</a></div></div><div class="public anchor" id="var-keep-keys"><h3>keep-keys</h3><div class="usage"><code>(keep-keys keys-to-keep &amp; children)</code></div><div class="doc"><div class="markdown"><p>Keep only the specified keys for events.</p>
<pre><code class="language-clojure">(keep-keys [:host :metric :time :environment :description]
  (info))
</code></pre>
<p>Also works with nested keys:</p>
<pre><code class="language-clojure">(keep-keys [:host :metric :time [:a :nested-key]]
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2207">view source</a></div></div><div class="public anchor" id="var-keep-keys*"><h3>keep-keys*</h3><div class="usage"><code>(keep-keys* _ keys-to-keep &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2196">view source</a></div></div><div class="public anchor" id="var-keyword-.3Eaggr-finalizer-fn"><h3>keyword-&gt;aggr-finalizer-fn</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2350">view source</a></div></div><div class="public anchor" id="var-keyword-.3Eaggr-fn"><h3>keyword-&gt;aggr-fn</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2285">view source</a></div></div><div class="public anchor" id="var-log-action"><h3>log-action</h3><div class="usage"><code>(log-action source-stream level)</code></div><div class="doc"><div class="markdown"><p>Generic logger</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L177">view source</a></div></div><div class="public anchor" id="var-mean"><h3>mean</h3><div class="usage"><code>(mean config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Get the mean of event metrics from the last dt seconds.</p>
<pre><code class="language-clojure">(mean {:duration 10}
  (info))
</code></pre>
<p>You can pass a <code>:delay</code> key to the configuration in order to tolerate late events. In that case, events from previous windows will be flushed after this delay:</p>
<pre><code class="language-clojure">(mean {:duration 10 :delay 5}
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2540">view source</a></div></div><div class="public anchor" id="var-moving-event-window"><h3>moving-event-window</h3><div class="usage"><code>(moving-event-window config &amp; children)</code></div><div class="doc"><div class="markdown"><p>A sliding window of the last few events. Every time an event arrives, calls children with a vector of the last n events, from oldest to newest. Ignores event times. Example:</p>
<pre><code class="language-clojure">(moving-event-window {:size 5}
  (coll-mean (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1231">view source</a></div></div><div class="public anchor" id="var-moving-event-window*"><h3>moving-event-window*</h3><div class="usage"><code>(moving-event-window* _ config &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1220">view source</a></div></div><div class="public anchor" id="var-moving-time-window"><h3>moving-time-window</h3><div class="usage"><code>(moving-time-window config &amp; children)</code></div><div class="doc"><div class="markdown"><p>A sliding window of all events with times within the last n seconds. Uses the maximum event time as the present-time horizon. Every time a new event arrives within the window, emits a vector of events in the window to children.</p>
<p>Events without times accrue in the current window.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2626">view source</a></div></div><div class="public anchor" id="var-moving-time-window*"><h3>moving-time-window*</h3><div class="usage"><code>(moving-time-window* _ {:keys [duration]} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2596">view source</a></div></div><div class="public anchor" id="var-not-expired"><h3>not-expired</h3><div class="usage"><code>(not-expired &amp; children)</code></div><div class="doc"><div class="markdown"><p>Keep non-expired events.</p>
<pre><code class="language-clojure">(not-expired
  (increment))

In this example, all non-expired events will be forwarded to the `increment`stream.
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L462">view source</a></div></div><div class="public anchor" id="var-not-expired*"><h3>not-expired*</h3><div class="usage"><code>(not-expired* _ &amp; children)</code></div><div class="doc"><div class="markdown"><p>Keep non-expired events.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L452">view source</a></div></div><div class="public anchor" id="var-output.21"><h3>output!</h3><div class="usage"><code>(output! output-name)</code></div><div class="doc"><div class="markdown"><p>Push events to an external system.</p>
<p>Outputs are configured into the main Mirabelle configuration file. If you create a new output named <code>:elasticsearch</code> for example, you can use output! to push all events into this I/O:</p>
<pre><code class="language-clojure">(output! :elasticsearch)
</code></pre>
<p>Outputs are automatically discarded in test mode.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L703">view source</a></div></div><div class="public anchor" id="var-output.21*"><h3>output!*</h3><div class="usage"><code>(output!* context output-name)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L690">view source</a></div></div><div class="public anchor" id="var-outside-dt"><h3>outside-dt</h3><div class="usage"><code>(outside-dt config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes two numbers, <code>low</code> and <code>high</code>, and a time period in seconds, <code>duration</code>. If the condition <code>the event metric is &lt; low or &gt; high</code> is valid for all events received during at least the period <code>duration</code>, valid events received after the <code>duration</code> period will be passed on until an invalid event arrives. <code>:metric</code> should not be nil (it will produce exceptions).</p>
<pre><code class="language-clojure">(outside-dt {:low 50 :high 100 :duration 10}
  (debug))
</code></pre>
<p>In this example, if the events <code>:metric</code> field are outside the 50-100 range for more than 10 seconds, events are passed downstream.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L594">view source</a></div></div><div class="public anchor" id="var-over"><h3>over</h3><div class="usage"><code>(over n &amp; children)</code></div><div class="doc"><div class="markdown"><p>Passes on events only when their metric is greater than x.</p>
<pre><code class="language-clojure">(over 10
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1289">view source</a></div></div><div class="public anchor" id="var-over*"><h3>over*</h3><div class="usage"><code>(over* _ n &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1279">view source</a></div></div><div class="public anchor" id="var-percentiles"><h3>percentiles</h3><div class="usage"><code>(percentiles config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Computes quantiles based on a stream of events. Results are flushed periodically downstreal based on the action configuration</p>
<pre><code class="language-clojure">(a/percentiles {:percentiles [0.5 0.75 0.99]
                :duration 10
                :nb-significant-digits 3})
</code></pre>
<p><code>:percentiles</code> contains a list of quantiles to compute, <code>:duration</code> is the duration before sending the result downstream, <code>:nb-significant-digits</code> is the precision for the computation.</p>
<p>After the end of the period, the action will generate one event for each percentile that is computed, with the key <code>:quantile</code> set to the percentile value. In this example, it would generate 3 events with <code>:quantile</code> equal to <code>0.5</code>, <code>0.75</code> or <code>0.99</code>.</p>
<p>The action also supports optinal options: a <code>:delay</code> option to tolerate late events (in that case the current window will be flushed <code>:delay</code> seconds after its end), and <code>:highest-trackabe-value</code> and <code>:lowest-discernible-value</code> to configure the histogram computation.</p>
<p>See hdrhistogram documentation (<a href="http://hdrhistogram.org/">http://hdrhistogram.org/</a>) for more information about these settings.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2909">view source</a></div></div><div class="public anchor" id="var-percentiles*"><h3>percentiles*</h3><div class="usage"><code>(percentiles* _ {:keys [duration percentiles delay highest-trackable-value nb-significant-digits lowest-discernible-value]} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2845">view source</a></div></div><div class="public anchor" id="var-project"><h3>project</h3><div class="usage"><code>(project conditions &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a list of conditions. Like coalesce, project will return the most recent events matching the conditions.</p>
<pre><code class="language-clojure">(project [[:= :service "enqueues"]
          [:= :service "dequeues"]]
  (coll-quotient
    (with :service "enqueues per dequeue"
      (info))))
</code></pre>
<p>We divide here the latest event for the “enqueues” :service by the latest event from the “dequeues” one.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1441">view source</a></div></div><div class="public anchor" id="var-project*"><h3>project*</h3><div class="usage"><code>(project* _ conditions &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1377">view source</a></div></div><div class="public anchor" id="var-publish.21"><h3>publish!</h3><div class="usage"><code>(publish! channel)</code></div><div class="doc"><div class="markdown"><p>Publish events in the given channel.</p>
<pre><code class="language-clojure">(publish! :my-channel)
</code></pre>
<p>Users can then subscribe to channels using the websocket engine.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1992">view source</a></div></div><div class="public anchor" id="var-publish.21*"><h3>publish!*</h3><div class="usage"><code>(publish!* context channel)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1983">view source</a></div></div><div class="public anchor" id="var-rate"><h3>rate</h3><div class="usage"><code>(rate config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Computes the rate of received events (by counting them) and emits the result at a periodic interval</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2836">view source</a></div></div><div class="public anchor" id="var-ratio"><h3>ratio</h3><div class="usage"><code>(ratio config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Computes the ratio for 2 conditions:</p>
<pre><code class="language-clojure">(ratio {:duration 30
        :conditions [[:= :state "error"] [:true]]}
  (info))
</code></pre>
<p>In this example, the action will count the number of events matching each conditions (:state = "error, and :true matching all events).</p>
<p>Every 30 seconds, an event will be send downstream with the :metric field set to the ratio between the count of events for the second condition and the count for the first one. For example, if the action received 30 events in total during the interval, and with 5 with :state = “error”, :metric will be equal to 5/30.</p>
<p>The latest event is used as a base to build the event that is sent downstream.</p>
<p>It also supports a :metric option. If set to true, the action will sum the :metric value of events matching conditions instead of counting them.</p>
<pre><code class="language-clojure">(ratio {:duration 30
        :conditions [[:= :state "error"] [:true]]
        :metric true}
  (info))
</code></pre>
<p>You can pass a <code>:delay</code> key to the configuration in order to tolerate late events. In that case, events from previous windows will be flushed after this delay.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2976">view source</a></div></div><div class="public anchor" id="var-ratio-state-update"><h3>ratio-state-update</h3><div class="usage"><code>(ratio-state-update state event state-fn cond1 cond2)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2279">view source</a></div></div><div class="public anchor" id="var-reinject.21"><h3>reinject!</h3><div class="usage"><code>(reinject!)</code><code>(reinject! destination-stream)</code></div><div class="doc"><div class="markdown"><p>Reinject an event into the streaming system. By default, events are reinject into the real time engine. You can reinject events to a specific stream by passing the destination stream as parameter.</p>
<pre><code class="language-clojure">(reinject)
</code></pre>
<p>This example reinjects events into the real stream engine.</p>
<pre><code class="language-clojure">(reinject :foo)
</code></pre>
<p>This example reinjects events into the stream named <code>:foo</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1653">view source</a></div></div><div class="public anchor" id="var-reinject.21*"><h3>reinject!*</h3><div class="usage"><code>(reinject!* context destination-stream)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1643">view source</a></div></div><div class="public anchor" id="var-rename-keys"><h3>rename-keys</h3><div class="usage"><code>(rename-keys replacement &amp; children)</code></div><div class="doc"><div class="markdown"><p>Rename events keys.</p>
<pre><code class="language-clojure">(rename-keys {:host :service
              :environment :env}
</code></pre>
<p>In this example, the <code>:host</code> key will be renamed <code>:service</code> and the <code>:environment</code> key is renamed <code>:env</code>.</p>
<p>You can also pass a list of keys as source or destination to rename nested attributes:</p>
<pre><code class="language-clojure">(rename-keys {[:attribute source] [:attribute: destination]
              :state [:attribute :state]
              [:attribute :host] :host})
</code></pre>
<p>Existing values will be overrided.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2167">view source</a></div></div><div class="public anchor" id="var-rename-keys*"><h3>rename-keys*</h3><div class="usage"><code>(rename-keys* _ replacement &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2140">view source</a></div></div><div class="public anchor" id="var-scale"><h3>scale</h3><div class="usage"><code>(scale factor &amp; children)</code></div><div class="doc"><div class="markdown"><p>Multiplies the event :metric field by the factor passed as parameter.</p>
<pre><code class="language-clojure">(scale 1000
  (info
</code></pre>
<p>This example will multiply the :metric field for all events by 1000.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1092">view source</a></div></div><div class="public anchor" id="var-scale*"><h3>scale*</h3><div class="usage"><code>(scale* _ factor &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1085">view source</a></div></div><div class="public anchor" id="var-scondition*"><h3>scondition*</h3><div class="usage"><code>(scondition* _ {:keys [condition]} &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2742">view source</a></div></div><div class="public anchor" id="var-sdissoc"><h3>sdissoc</h3><div class="usage"><code>(sdissoc fields &amp; children)</code></div><div class="doc"><div class="markdown"><p>Remove a key (or a list of keys) from the events.</p>
<pre><code class="language-clojure">(sdissoc :host (info))

(sdissoc [:environment :host] (info))

(sdissoc [:environment [:nested :key]] (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1511">view source</a></div></div><div class="public anchor" id="var-sdissoc*"><h3>sdissoc*</h3><div class="usage"><code>(sdissoc* _ fields &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1494">view source</a></div></div><div class="public anchor" id="var-sdo"><h3>sdo</h3><div class="usage"><code>(sdo &amp; children)</code></div><div class="doc"><div class="markdown"><p>Send events to children. useful when you want to send the same events to multiple downstream actions.</p>
<pre><code class="language-clojure">(sdo
  (increment)
  (decrement))
</code></pre>
<p>Here, events arriving in sdo will be forwarded to both increment and decrement.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L409">view source</a></div></div><div class="public anchor" id="var-sdo*"><h3>sdo*</h3><div class="usage"><code>(sdo* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L404">view source</a></div></div><div class="public anchor" id="var-select-keys-nested"><h3>select-keys-nested</h3><div class="usage"><code>(select-keys-nested event keyseq)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L42">view source</a></div></div><div class="public anchor" id="var-sflatten"><h3>sflatten</h3><div class="usage"><code>(sflatten &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streaming flatten. Calls children with each event in events. Events should be a sequence.</p>
<p>This stream can be used to “flat” a sequence of events (emitted by a time window stream for example).</p>
<pre><code class="language-clojure">(fixed-event-window {:size 5}
  (sflatten
    (info)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L921">view source</a></div></div><div class="public anchor" id="var-sflatten*"><h3>sflatten*</h3><div class="usage"><code>(sflatten* _ &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L915">view source</a></div></div><div class="public anchor" id="var-sformat"><h3>sformat</h3><div class="usage"><code>(sformat template target-field fields &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes the content of multiple event keys, and use them to build a string value and assign it to a given key.</p>
<pre><code class="language-clojure">(sformat "%s-foo-%s" :format-test [:host :service])
</code></pre>
<p>If the event <code>{:host "machine" :service "bar"}</code> is passed to this action the event will become <code>{:host "machine" :service "bar" :format-test "machine-foo-bar"}</code>.</p>
<p>It also supports nested keys both for the destination or the fields to extract:</p>
<pre><code class="language-clojure">(sformat "%s-foo-%s" [:nested :key] [[:host :name] :service])
</code></pre>
<p>More information about availables formatters in the Clojure documentation: <a href="https://clojuredocs.org/clojure.core/format">https://clojuredocs.org/clojure.core/format</a></p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1953">view source</a></div></div><div class="public anchor" id="var-sformat*"><h3>sformat*</h3><div class="usage"><code>(sformat* _ template target-field fields &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1929">view source</a></div></div><div class="public anchor" id="var-smax"><h3>smax</h3><div class="usage"><code>(smax &amp; children)</code></div><div class="doc"><div class="markdown"><p>Send downstream the event with the biggest :metric every time it receives an event</p>
<pre><code class="language-clojure">(smax
  (info))
</code></pre>
<p>If the events <code>{:time 1 :metric 10} {:time 2 :metric 3} {:time 3 :metric 11}</code> are injected, <code>info</code> will receive:</p>
<pre><code>{:time 1 :metric 10} {:time 1 :metric 10} {:time 3 :metric 11}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2751">view source</a></div></div><div class="public anchor" id="var-smin"><h3>smin</h3><div class="usage"><code>(smin &amp; children)</code></div><div class="doc"><div class="markdown"><p>Send downstream the event with the lowest :metric every time it receives an event</p>
<pre><code class="language-clojure">(smin
  (info))
</code></pre>
<p>If the events <code>{:time 1 :metric 10} {:time 2 :metric 3} {:time 3 :metric 11}</code> are injected, <code>info</code> will receive:</p>
<pre><code class="language-clojure">{:time 1 :metric 10} {:time 2 :metric 3} {:time 3 :metric 11}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2774">view source</a></div></div><div class="public anchor" id="var-split"><h3>split</h3><div class="usage"><code>(split &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Split by conditions.</p>
<pre><code class="language-clojure">(split
  [:&gt; :metric 10] (debug)
  [:&gt; :metric 5] (info)
  (error)
</code></pre>
<p>In this example, all events with :metric &gt; 10 will go into the debug stream, all events with :metric &gt; 5 in the info stream, and other events will to the default stream which is “error”.</p>
<p>The default stream is optional, if not set all events not matching a condition will be discarded.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1126">view source</a></div></div><div class="public anchor" id="var-split*"><h3>split*</h3><div class="usage"><code>(split* _ clauses &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1109">view source</a></div></div><div class="public anchor" id="var-ssort"><h3>ssort</h3><div class="usage"><code>(ssort config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streaming sort. Takes a configuration containing a <code>:duration</code> and a <code>:field</code> key. The action will buffer events during <code>:duration</code> seconds and then send the events downstream one by one, sorted by <code>:field</code>.</p>
<pre><code class="language-clojure">(ssort {:duration 10 :field :time}
  (info))
</code></pre>
<p>This example will sort events based on the :time field.</p>
<p>For example, if it get as input:</p>
<pre><code class="language-clojure">{:time 1} {:time 10} {:time 4} {:time 9} {:time 13} {:time 31}
</code></pre>
<p>Info will receive these events:</p>
<pre><code class="language-clojure">{:time 1} {:time 4} {:time 9} {:time 10} {:time 13}
</code></pre>
<p>You can add a <code>:delay</code> key to the action configuration in order to tolerate late events:</p>
<pre><code class="language-clojure">(ssort {:duration 10 :field :time :delay 10}
  (info))
</code></pre>
<p>In this example, events from previous windows will be sent with a delay of 10 seconds.</p>
<p><code>ssort</code> supports sorting on a nested field (example <code>:field [:nested :field]</code>)</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2644">view source</a></div></div><div class="public anchor" id="var-stable"><h3>stable</h3><div class="usage"><code>(stable dt field &amp; children)</code></div><div class="doc"><div class="markdown"><p>Takes a duration (dt) in second and a field name as parameter. Returns events where the value of the field specified as second argument is equal to the value of the field for the last event, for at least dt seconds. Events can be buffered for dt seconds before being forwarded in order to see if they are stable or not.</p>
<p>Events should arrive in order (old events will be dropped).</p>
<p>You can use this stream to remove flapping states for example.</p>
<pre><code class="language-clojure">(stable 10 :state
  (info))
</code></pre>
<p>In this example, events will be forwarded of the value of the <code>:state</code> key is the same for at least 10 seconds.</p>
<p>Support nested fields:</p>
<pre><code class="language-clojure">(stable 10 [:nested :field]
  (info))
```.</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2106">view source</a></div></div><div class="public anchor" id="var-stable*"><h3>stable*</h3><div class="usage"><code>(stable* _ dt field &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2053">view source</a></div></div><div class="public anchor" id="var-stream"><h3>stream</h3><div class="usage"><code>(stream config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Creates a new stream. This action takes a map where the <code>:name</code> key, which will be the name of the stream, is mandatory.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1829">view source</a></div></div><div class="public anchor" id="var-streams"><h3>streams</h3><div class="usage"><code>(streams &amp; streams)</code></div><div class="doc"><div class="markdown"><p>Entrypoint for all streams.</p>
<pre><code class="language-clojure">(streams
  (stream {:name :fobar}
    (info))
  (stream {:name :foo}
    (info)))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1835">view source</a></div></div><div class="public anchor" id="var-sum"><h3>sum</h3><div class="usage"><code>(sum config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Sum the events field from the last dt seconds.</p>
<pre><code class="language-clojure">(sum {:duration 10}
  (info))
</code></pre>
<p>You can pass a <code>:delay</code> key to the configuration in order to tolerate late events. In that case, events from previous windows will be flushed after this delay:</p>
<pre><code class="language-clojure">(sum {:duration 10 :delay 5}
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2468">view source</a></div></div><div class="public anchor" id="var-tag"><h3>tag</h3><div class="usage"><code>(tag tags &amp; children)</code></div><div class="doc"><div class="markdown"><p>Adds a new tag, or set of tags, to events which flow through.</p>
<pre><code class="language-clojure">(tag "foo"
  (info))
</code></pre>
<p>This example adds the tag “foo” to events.</p>
<pre><code class="language-clojure">(tag ["foo" "bar"] (info))
</code></pre>
<p>This example adds the tag “foo” and “bar” to events.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L950">view source</a></div></div><div class="public anchor" id="var-tag*"><h3>tag*</h3><div class="usage"><code>(tag* _ tags &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L939">view source</a></div></div><div class="public anchor" id="var-tagged-all"><h3>tagged-all</h3><div class="usage"><code>(tagged-all tags &amp; children)</code></div><div class="doc"><div class="markdown"><p>Passes on events where all tags are present.</p>
<pre><code class="language-clojure">(tagged-all "foo"
  (info))
</code></pre>
<p>This example keeps only events tagged “foo”.</p>
<pre><code class="language-clojure">(tagged-all ["foo" "bar"] (info))
</code></pre>
<p>This example keeps only events tagged “foo” and “bar”.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1018">view source</a></div></div><div class="public anchor" id="var-tagged-all*"><h3>tagged-all*</h3><div class="usage"><code>(tagged-all* _ tags &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1006">view source</a></div></div><div class="public anchor" id="var-tap"><h3>tap</h3><div class="usage"><code>(tap tap-name)</code></div><div class="doc"><div class="markdown"><p>Save events into the tap. Noop outside tests.</p>
<pre><code class="language-clojure">(where [:= :service "foo"]
  (tap :foo)
</code></pre>
<p>In test mode, all events with <code>:service</code> “foo” will be saved in a tap named <code>:foo</code></p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1737">view source</a></div></div><div class="public anchor" id="var-tap*"><h3>tap*</h3><div class="usage"><code>(tap* context tape-name)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1724">view source</a></div></div><div class="public anchor" id="var-test-action"><h3>test-action</h3><div class="usage"><code>(test-action state &amp; children)</code></div><div class="doc"><div class="markdown"><p>Bufferize all received events in the state (an atom) passed as parameter</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L396">view source</a></div></div><div class="public anchor" id="var-test-action*"><h3>test-action*</h3><div class="usage"><code>(test-action* _ state)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L391">view source</a></div></div><div class="public anchor" id="var-throttle"><h3>throttle</h3><div class="usage"><code>(throttle config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Let N event pass at most every duration seconds. Can be used for example to avoid sending to limit the number of alerts sent to an external system.</p>
<pre><code class="language-clojure">(throttle {:count 3 :duration 10}
  (error))
</code></pre>
<p>In this example, throttle will let 3 events pass at most every 10 seconds. Other events, or events with no time, are filtered.</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1198">view source</a></div></div><div class="public anchor" id="var-throttle*"><h3>throttle*</h3><div class="usage"><code>(throttle* _ config &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1163">view source</a></div></div><div class="public anchor" id="var-to-base64"><h3>to-base64</h3><div class="usage"><code>(to-base64 field &amp; children)</code></div><div class="doc"><div class="markdown"><p>Convert a field to base64. Field value should be string.</p>
<pre><code class="language-clojure">(sdo
  ;; you can pass one field
  (to-base64 :host)
  ;; or a list to update a nested keys
  (to-base64 [:host :service]))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1879">view source</a></div></div><div class="public anchor" id="var-to-base64*"><h3>to-base64*</h3><div class="usage"><code>(to-base64* _ fields &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1871">view source</a></div></div><div class="public anchor" id="var-to-string"><h3>to-string</h3><div class="usage"><code>(to-string keys &amp; children)</code></div><div class="doc"><div class="markdown"><p>Converts values associated to keys to string. nil values are converted to an empty string. The parameter is a list of keys. It supports updating nested keys by passing a list of keywords.</p>
<pre><code class="language-clojure">(to-string [:service :state]
  (info))
</code></pre>
<pre><code class="language-clojure">(to-string [[:attributes :name] :quantile]
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2948">view source</a></div></div><div class="public anchor" id="var-to-string*"><h3>to-string*</h3><div class="usage"><code>(to-string* _ keys &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2935">view source</a></div></div><div class="public anchor" id="var-top"><h3>top</h3><div class="usage"><code>(top config &amp; children)</code></div><div class="doc"><div class="markdown"><p>Get the max event from the last dt seconds.</p>
<pre><code class="language-clojure">(top {:duration 10}
  (info))
</code></pre>
<p>You can pass a <code>:delay</code> key to the configuration in order to tolerate late events. In that case, events from previous windows will be flushed after this delay:</p>
<pre><code class="language-clojure">(top {:duration 10 :delay 5}
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L2492">view source</a></div></div><div class="public anchor" id="var-under"><h3>under</h3><div class="usage"><code>(under n &amp; children)</code></div><div class="doc"><div class="markdown"><p>Passes on events only when their metric is under than x.</p>
<pre><code class="language-clojure">(under 10
  (info))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1314">view source</a></div></div><div class="public anchor" id="var-under*"><h3>under*</h3><div class="usage"><code>(under* _ n &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L1304">view source</a></div></div><div class="public anchor" id="var-untag"><h3>untag</h3><div class="usage"><code>(untag tags &amp; children)</code></div><div class="doc"><div class="markdown"><p>Removes a tag, or set of tags, from events which flow through.</p>
<pre><code class="language-clojure">(untag "foo" (debug))
</code></pre>
<p>This example removes the tag “foo” from events.</p>
<pre><code class="language-clojure">(untag ["foo" "bar"] (debug))
</code></pre>
<p>This example removes the tags “foo” and “bar” from events</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L984">view source</a></div></div><div class="public anchor" id="var-untag*"><h3>untag*</h3><div class="usage"><code>(untag* _ tags &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L972">view source</a></div></div><div class="public anchor" id="var-where"><h3>where</h3><div class="usage"><code>(where conditions &amp; children)</code></div><div class="doc"><div class="markdown"><p>Filter events based on conditions. Each condition is a vector composed of the function to apply on the field, the field to extract from the event, and the event itself. Multiple conditions can be added by using <code>:or</code> or <code>:and</code>.</p>
<pre><code class="language-clojure">(where [:= :metric 4])
</code></pre>
<p>Here, we keep only events where the :metric field is equal to 4.</p>
<pre><code class="language-clojure">(where [:and [:= :host "foo"]
             [:&gt; :metric 10])
</code></pre>
<p>Here, we keep only events with :host = foo and with :metric &gt; 10</p>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L89">view source</a></div></div><div class="public anchor" id="var-where*"><h3>where*</h3><div class="usage"><code>(where* _ conditions &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L79">view source</a></div></div><div class="public anchor" id="var-with"><h3>with</h3><div class="usage"><code>(with &amp; args)</code></div><div class="doc"><div class="markdown"><p>Set an event field to the given value.</p>
<pre><code class="language-clojure">(with :state "critical"
  (debug))
</code></pre>
<p>This example set the field <code>:state</code> to “critical” for events.</p>
<p>A map can also be provided:</p>
<pre><code class="language-clojure">(with {:service "foo" :state "critical"}
  (debug))
</code></pre>
<p>This example set the the field <code>:service</code> to “foo” and the field <code>:state</code> to “critical” for events.</p>
<p>This action also supports updated nested keys:</p>
<pre><code class="language-clojure">(with [:nested :key] "critical"
  (debug))
</code></pre>
<pre><code class="language-clojure">(with {[:nested :key] "critical"}
  (debug))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L835">view source</a></div></div><div class="public anchor" id="var-with*"><h3>with*</h3><div class="usage"><code>(with* _ fields &amp; children)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mcorbin/mirabelle/blob/0.13.0/src/clojure/mirabelle/action.clj#L823">view source</a></div></div></div></body></html>