<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title> :: Mirabelle</title>

    
    <link href="/css/nucleus.css?1620513491" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1620513491" rel="stylesheet">
    <link href="/css/hybrid.css?1620513491" rel="stylesheet">
    <link href="/css/featherlight.min.css?1620513491" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1620513491" rel="stylesheet">
    <link href="/css/auto-complete.css?1620513491" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1620513491" rel="stylesheet">
    <link href="/css/theme.css?1620513491" rel="stylesheet">
    <link href="/css/tabs.css?1620513491" rel="stylesheet">
    <link href="/css/hugo-theme.css?1620513491" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1620513491"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://www.mirabelle.mcorbin.fr">
  <h2>Mirabelle</p>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1620513491"></script>
<script type="text/javascript" src="/js/auto-complete.js?1620513491"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/www.mirabelle.mcorbin.fr";
    
</script>
<script type="text/javascript" src="/js/search.js?1620513491"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/howto/" title="How to" class="dd-item
        
        
        
        ">
      <a href="/howto/">
          How to
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/howto/build/" title="Install or build Mirabelle" class="dd-item
        
        
        
        ">
      <a href="/howto/build/">
          Install or build Mirabelle
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/configuration/" title="Configuration" class="dd-item
        
        
        
        ">
      <a href="/howto/configuration/">
          Configuration
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/stream/" title="Writing streams" class="dd-item
        
        
        
        ">
      <a href="/howto/stream/">
          Writing streams
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/tests/" title="Writing tests" class="dd-item
        
        
        
        ">
      <a href="/howto/tests/">
          Writing tests
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/action-io-ref/" title="I/O and actions reference" class="dd-item
        
        
        
        ">
      <a href="/howto/action-io-ref/">
          I/O and actions reference
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/index/" title="The index" class="dd-item
        
        
        
        ">
      <a href="/howto/index/">
          The index
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/pubsub/" title="Publish Subscribe" class="dd-item
        
        
        
        ">
      <a href="/howto/pubsub/">
          Publish Subscribe
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/howto/on-disk-queue/" title="On Disk queue" class="dd-item
        
        
        
        ">
      <a href="/howto/on-disk-queue/">
          On Disk queue
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/production/" title="Mirabelle in production" class="dd-item
        
        
        
        ">
      <a href="/production/">
          Mirabelle in production
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/api/" title="HTTP API" class="dd-item
        
        
        
        ">
      <a href="/api/">
          HTTP API
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/extension/" title="Extend Mirabelle" class="dd-item
        
        
        
        ">
      <a href="/extension/">
          Extend Mirabelle
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/integration/" title="Clients and integrations" class="dd-item
        
        
        
        ">
      <a href="/integration/">
          Clients and integrations
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/riemann-diff/" title="Differences with Riemann" class="dd-item
        
        
        
        ">
      <a href="/riemann-diff/">
          Differences with Riemann
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/support/" title="Support and contributions" class="dd-item
        
        
        
        ">
      <a href="/support/">
          Support and contributions
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <b><p>Powered by <a href="https://mcorbin.fr">mcorbin</a></p></b>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          

        

<span id="sidebar-toggle-span">
<a href="#" id="sidebar-toggle" data-sidebar-toggle=""><i class="fas fa-bars"></i> navigation</a>
</span>

 
<h1 id="mirabelle-a-powerful-stream-processing-engine-for-monitoring">Mirabelle, a powerful stream processing engine for monitoring</h1>
<p>Mirabelle is stream processing engine which can be used to aggregate events, metrics and logs.</p>
<p>Its powerful and extensible DSL allows you to define computations on a stream of data. Mirabelle offers natively a lot of functions (time windows, mathematical operations, transforming data, relabelling&hellip;) which can be easily combined according to your needs.</p>
<p><img src="img/mirabelle_presentation.png" alt="Mirabelle"></p>
<p>Mirabelle can also route events to external systems (timeserie databases, logging systems, cloud monitoring services&hellip;), fire alerts (Pagerduty), write data into files&hellip;</p>
<p>It also implements a publish-subscribe system, which allows you to see in real time (through Websockets) events flowing into streams.</p>
<p>Mirabelle is in alpha, but I&rsquo;m eager to receive feedbacks</p>
<h2 id="fully-compatible-with-riemann">Fully compatible with Riemann</h2>
<p>Mirabelle is heavily inspired by <a href="http://riemann.io/">Riemann</a>. Actually, part of the Mirabelle codebase (some streams and the TCP server implementation for example) was imported from Riemann (these parts are mentionned in the codebase).</p>
<p>I would like to thank all Riemann maintainers and contributors for this amazing tool.</p>
<p>Mirabelle use the same protocol than Riemann. It means all Riemann tooling and integrations should work seamlessy with Mirabelle (which also added a lot of new features).</p>
<p>Like in Riemaann, Mirabelle provides an index which can be queried (and on which you can subscribe) in order to explore your system state.</p>
<h2 id="streams-clocks-real-time-continuous-queries">Streams clocks, real time, continuous queries</h2>
<p>In Mirabelle (and unlike in Riemann), <strong>all</strong> streams advance based on the time of the events they receive. Because of that, it&rsquo;s super easy to reason about your streams, and to unit test them (the same inputs always produce the same outputs).</p>
<p>In Mirabelle, events arrive by default in streams defined in the Mirabelle configuration file. As said previously, the Mirabelle clock for a stream will only advance if you send new events.</p>
<p>You can also in Mirabelle instantiate steams on the fly (using the Mirabelle HTTP API) and push events into these new streams. All streams have their own clocks and can advance independently. You can choose on which stream clients should push events, and define which streams should be used by default.</p>
<p><img src="img/mirabelle_streams.png" alt="Mirabelle"></p>
<p>You can have real time streams receiving events directly from your servers and applications, and some streams working on old (and maybe ordered) data coming from various databases. Like that, you can have the best of both words: real time analytics, and run analytics on old data using continuous queries for example.</p>
<p>You can even use Mirabelle to play and explore with historical data. You could have for example a Mirabelle instance used for real time stream processing, another one (or even the same one on dedicated streams) working on old data&hellip; It&rsquo;s up to you to decide !</p>
<h2 id="stream-example-with-unit-tests">Stream example, with unit tests</h2>
<p>Let&rsquo;s say a web application is pushing the duration (in seconds) of the http requests it receives. This metric could be modelised using this Mirabelle event</p>
<pre><code>{:host &quot;my-server&quot;
 :service &quot;http_request_duration_seconds&quot;
 :application &quot;my-web-app&quot;
 :time 1619731016,145
 :tags [&quot;web&quot;]
 :metric 0.5}
</code></pre><p>You could write a Mirabelle stream which will compute on the fly the quantiles for this metric. In this example, Mirabelle will split the received events into 60 seconds windows, then compute the percentiles, set the event <code>:state</code> to &ldquo;critical&rdquo; and send an alert to Pagerduty if the <code>0.99</code> quantiles is greater than 1 seocnd.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#a6e22e">streams</span>
  (<span style="color:#a6e22e">stream</span> {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">:percentiles</span>}
    (<span style="color:#a6e22e">where</span> [<span style="color:#e6db74">:=</span> <span style="color:#e6db74">:service</span> <span style="color:#e6db74">&#34;http_request_duration_seconds&#34;</span>]
      (<span style="color:#a6e22e">fixed-time-window</span> <span style="color:#ae81ff">60</span>
        (<span style="color:#a6e22e">percentiles</span> [<span style="color:#ae81ff">0.5</span> <span style="color:#ae81ff">0.75</span> <span style="color:#ae81ff">0.99</span>]
          (<span style="color:#a6e22e">where</span> [<span style="color:#e6db74">:and</span> [<span style="color:#e6db74">:=</span> <span style="color:#e6db74">:quantile</span> <span style="color:#ae81ff">0.99</span>]
                       [<span style="color:#e6db74">:&gt;</span> <span style="color:#e6db74">:metric</span> <span style="color:#ae81ff">1</span>]]
            (<span style="color:#a6e22e">with</span> <span style="color:#e6db74">:state</span> <span style="color:#e6db74">&#34;critical&#34;</span>
              (<span style="color:#a6e22e">tap</span> <span style="color:#e6db74">:alert</span>)
              (<span style="color:#a6e22e">push-io!</span> <span style="color:#e6db74">:pagerduty</span>))))))))
</code></pre></div><p>The <code>tap</code> action is an action which will be only enabled in test mode, and which will save in a tap named <code>:alert</code> events passing by it. Indeed, everything can be unit tested easily in Mirabelle.</p>
<p>A test for this stream would be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">{<span style="color:#e6db74">:percentiles</span> {<span style="color:#e6db74">:input</span> [{<span style="color:#e6db74">:service</span> <span style="color:#e6db74">&#34;http_request_duration_seconds&#34;</span>
                        <span style="color:#e6db74">:metric</span> <span style="color:#ae81ff">0.1</span>
                        <span style="color:#e6db74">:time</span> <span style="color:#ae81ff">1</span>}
                       {<span style="color:#e6db74">:service</span> <span style="color:#e6db74">&#34;http_request_duration_seconds&#34;</span>
                        <span style="color:#e6db74">:metric</span> <span style="color:#ae81ff">1.2</span>
                        <span style="color:#e6db74">:time</span> <span style="color:#ae81ff">30</span>}
                       {<span style="color:#e6db74">:service</span> <span style="color:#e6db74">&#34;http_request_duration_seconds&#34;</span>
                        <span style="color:#e6db74">:metric</span> <span style="color:#ae81ff">0.2</span>
                        <span style="color:#e6db74">:time</span> <span style="color:#ae81ff">70</span>}]
               <span style="color:#e6db74">:tap-results</span> {<span style="color:#e6db74">:alert</span> [{<span style="color:#e6db74">:service</span> <span style="color:#e6db74">&#34;http_request_duration_seconds&#34;</span>
                                      <span style="color:#e6db74">:metric</span> <span style="color:#ae81ff">1.2</span>
                                      <span style="color:#e6db74">:time</span> <span style="color:#ae81ff">30</span>
                                      <span style="color:#e6db74">:quantile</span> <span style="color:#ae81ff">0.99</span>
                                      <span style="color:#e6db74">:state</span> <span style="color:#e6db74">&#34;critical&#34;</span>}]}}}
</code></pre></div><p>In this test, we inject into the <code>:percentiles</code> stream three events, and we verify that the tap named <code>:alert</code> contains the expected alert (the <code>0.99</code> quantile is greater than 1) generated for these events.</p>
<p>Thanks to Clojure datastructures, these is <em>no side effects between streams and actions</em>. It&rsquo;s OK to modify events in parallel (in multiple threads) and to have multiple branches per stream. You can even pass events between streams (like described <a href="todo">here</a>). You are free to organize streams and how they communicate between each other exactly how you want to, the tool and its DSL will not limit you on than.</p>
<p>Here is a more complete and commented example, with multiple actions performed in one stream:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#a6e22e">streams</span>
  (<span style="color:#a6e22e">stream</span> {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">:multiple-branches</span>}
    (<span style="color:#a6e22e">where</span> [<span style="color:#e6db74">:=</span> <span style="color:#e6db74">:service</span> <span style="color:#e6db74">&#34;http_request_duration_seconds&#34;</span>]
      (<span style="color:#a6e22e">with</span> <span style="color:#e6db74">:ttl</span> <span style="color:#ae81ff">60</span>
        <span style="color:#75715e">;; push everything into influxdb</span>
        (<span style="color:#a6e22e">push-io!</span> <span style="color:#e6db74">:influxdb</span>)
        <span style="color:#75715e">;; index events in memory by host and service</span>
        (index [<span style="color:#e6db74">:host</span> <span style="color:#e6db74">:service</span>])
        <span style="color:#75715e">;; by will generate a branch for each :host value. Like that, downstream</span>
        <span style="color:#75715e">;; computations will be per host and will not conflict between each other</span>
        (<span style="color:#a6e22e">by</span> [<span style="color:#e6db74">:host</span>]
          <span style="color:#75715e">;; if the metric is greater than 1 for more than 60 seconds</span>
          <span style="color:#75715e">;; Pass events downstream</span>
          (<span style="color:#a6e22e">above-dt</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">60</span>
            <span style="color:#75715e">;; pass the state to critical</span>
            (<span style="color:#a6e22e">with</span> <span style="color:#e6db74">:state</span> <span style="color:#e6db74">&#34;critical&#34;</span>
              <span style="color:#75715e">;; one alert only every 60 sec to avoid flooding pagerduty</span>
              (<span style="color:#a6e22e">throttle</span> <span style="color:#ae81ff">60</span>
                (<span style="color:#a6e22e">push-io!</span> <span style="color:#e6db74">:pagerduty</span>)))))))))
</code></pre></div><p>As you can see, events can flow in multiple branches without causing side effects.</p>
	
  
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
		
			<a class="nav nav-next" href="/howto/" title="How to" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1620513491"></script>
    <script src="/js/perfect-scrollbar.min.js?1620513491"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1620513491"></script>
    <script src="/js/jquery.sticky.js?1620513491"></script>
    <script src="/js/featherlight.min.js?1620513491"></script>
    <script src="/js/highlight.pack.js?1620513491"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1620513491"></script>
    <script src="/js/learn.js?1620513491"></script>
    <script src="/js/hugo-learn.js?1620513491"></script>
    
        
            <script src="/mermaid/mermaid.js?1620513491"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

